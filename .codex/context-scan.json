{
  "timestamp": "2025-12-15T09:58:00Z",
  "scope": "Noise_Spectrum 前缀数据路由集成扫描",
  "locations": [
    "src/voc_app/gui/foup_acquisition.py",
    "src/voc_app/gui/spectrum_model.py",
    "src/voc_app/gui/csv_model.py",
    "src/voc_app/gui/qml/components/ChartCard.qml",
    "src/voc_app/gui/qml/views/StatusView.qml",
    "src/voc_app/gui/app.py",
    "examples/test_server.py"
  ],
  "current_state": {
    "data_ingest": "FoupAcquisitionController 使用 SocketCommunicator 读取 4 字节长度前缀 + UTF-8 文本，_handle_line 解析逗号分隔浮点值并分发。历史逻辑默认走 dataPointReceived：将每个通道的单点追加到对应 SeriesTableModel（FOUP 曲线）；时间戳在本地生成。",
    "server_identity": "建连后先发送 get_function_version_info，解析返回如 \"VOC,V1.0.0\"，将首段识别为服务器 prefix（大写）并缓存。",
    "spectrum_api": "SpectrumDataModel 提供 updateSpectrum(list[float])，可一次性替换 256 点频谱并触发 spectrumDataChanged，QML 的 SpectrumChart.qml 监听该信号重绘。",
    "buffer_render": "SeriesTableModel 保存最近 max_rows（app.py 创建时为 60）条 [ts, value]，溢出时移除首行并重算边界；ChartCard.qml 通过 VXYModelMapper 将 model 映射到 LineSeries/ScatterSeries，boundsChanged 时重新计算轴和 OOC/OOS/Target 参考线，useOpenGL 处于注释状态。",
    "ui_usage": "StatusView.qml 将 FOUP/Loadport 通道以 GridLayout + ChartCard 显示，FOUP 最多 8 通道，每个卡片独立更新；示例定时器 data_update_timer 仅以 1s 间隔生成随机点演示低频刷新。",
    "protocol_samples": "examples/test_server.py 展示的示例服务器使用相同长度前缀协议，建连后返回 \"{prefix},{version}\"，实时推送时仅发送数值（无每包 prefix）。"
  },
  "similar_components": [
    {
      "file": "src/voc_app/gui/csv_model.py",
      "note": "CsvFileManager + CsvDataModel 支持从磁盘 CSV 读取静态 dataPoints 并喂给 ChartCard，用于离线曲线而非实时高频波形。"
    },
    {
      "file": "src/voc_app/gui/qml_socket_client_bridge.py",
      "note": "向 QML 暴露 runShell/getFile 能力，可复用现有协议下载日志，但同样是离线文件，不是流式波形。"
    }
  ],
  "tests": {
    "existing": [
      "tests/test_foup_acquisition.py",
      "tests/test_spectrum_model.py"
    ],
    "gaps": "未覆盖真实 socket/server 的端到端推流与 QML 渲染，仅能通过单元测试验证路由与模型更新。"
  },
  "observations": [
    "Noise_Spectrum 的 256 点数据不适合复用 FOUP 的“按通道追加单点”模型，应该走 SpectrumDataModel.updateSpectrum 进行整体替换。",
    "ChannelConfigManager.set_prefix 会为未知前缀按 channel_count 创建并持久化每通道配置；对 256 点频谱会产生大量无意义配置，应在频谱路由下跳过该初始化。",
    "频谱页已有 Python 模型与 QML 组件，只需要把解析后的数值序列路由过去即可完成集成。"
  ]
}
